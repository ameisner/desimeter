#!/usr/bin/env python

import sys
import numpy as np
import matplotlib.pyplot as plt
from astropy.table import Table

from desimeter.transform.pos2ptl import int2loc,loc2flat


import argparse
parser = argparse.ArgumentParser(description=__doc__)
parser.add_argument('-i', '--infile', type=str, required=True, 
                    help='path to input csv file like M02012.csv')

args = parser.parse_args()

filename=args.infile
t=Table.read(filename)
print(t.dtype.names)


#plt.figure()
#plt.hist(t['DELTAT'],bins=100)


r1=t['LENGTH_R1'][0]
r2=t['LENGTH_R2'][0]
t_offset=t['OFFSET_T'][0]
p_offset=t['OFFSET_P'][0]
x_offset=t['OFFSET_X'][0]
y_offset=t['OFFSET_Y'][0]
x_loc, y_loc = int2loc(t["POS_T"],t["POS_P"], r1, r2, t_offset, p_offset)
x_flat = loc2flat(x_loc,x_offset)
y_flat = loc2flat(y_loc,y_offset)

x_fp=t["X_FP"]
y_fp=t["Y_FP"]

#plt.figure('T_STAMP')
#plt.plot(t['TSTAMP_POSMOVE'],t['TSTAMP_FVC'],"o")
#plt.plot(t['DELTAT'],t['TSTAMP_FVC']-t['TSTAMP_POSMOVE'],"o")

name=t['POS_ID'][0]

plt.figure(name+"-1")
plt.subplot(211,title=name)
plt.plot(x_flat,x_fp,"o")
plt.xlabel("expected X(THETA,PHI) (mm)")
plt.ylabel("desimeter measured X (mm)")
plt.subplot(212)
plt.plot(y_flat,y_fp,"o")
plt.xlabel("expected Y(THETA,PHI) (mm)")
plt.ylabel("desimeter measured Y (mm)")

plt.figure(name)
a=plt.subplot(111,title=name)
plt.plot(x_fp,y_fp,"o",label="measured with desimeter")
plt.plot(x_flat,y_flat,"x",label="expected from posmove db")
plt.xlabel("X (mm)")
plt.ylabel("Y (mm)")
plt.legend()

plt.show()
